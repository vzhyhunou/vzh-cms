function s(e){this.message=e}s.prototype=new Error,s.prototype.name="InvalidCharacterError";var d=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new s("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,o=0,a=0,h="";r=t.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?h+=String.fromCharCode(255&n>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return h};function f(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(n){return decodeURIComponent(d(n).replace(/(.)/g,function(r,o){var a=o.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}(t)}catch{return d(t)}}function i(e){this.message=e}function w(e,t){if(typeof e!="string")throw new i("Invalid token specified");var n=(t=t||{}).header===!0?0:1;try{return JSON.parse(f(e.split(".")[n]))}catch(r){throw new i("Invalid token specified: "+r.message)}}i.prototype=new Error,i.prototype.name="InvalidTokenError";const l="token",g=e=>localStorage.setItem(l,e),c=()=>localStorage.getItem(l),u=()=>localStorage.removeItem(l),m=()=>{const e=c();return e?w(e):{}},p=()=>({login:({username:e,password:t})=>{const r={Authorization:`Basic ${btoa(`${e}:${t}`)}`};return fetch("/login",{headers:r}).then(o=>{if(o.status<200||o.status>=300)throw new Error(o.statusText);return o.text()}).then(g)},logout:e=>Promise.resolve().then(u).then(()=>{if(typeof e=="string")return e}),checkError:({status:e})=>Promise.resolve().then(()=>{if(e===401||e===403)return u(),Promise.reject()}),checkAuth:()=>c()?Promise.resolve():Promise.reject(),getPermissions:()=>Promise.resolve().then(m).then(({roles:e})=>e),getUserId:()=>Promise.resolve().then(m).then(({sub:e})=>e),setToken:e=>Promise.resolve(e).then(g),getToken:()=>Promise.resolve().then(c)});export{p as default};
